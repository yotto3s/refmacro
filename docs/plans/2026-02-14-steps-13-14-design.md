# Steps 13–14: Error Reporting & Integration Tests

> **Date:** 2026-02-14
> **Status:** Approved — ready for parallel execution

## Overview

Final two steps of the refinement type system implementation. Executed in parallel since they modify disjoint files and Step 13 only changes error message format (not detection logic).

## Step 13 — Error Reporting

**Goal:** Replace bare `throw "type error: ..."` strings with structured multi-line diagnostics.

**Files modified:** `check.hpp`, `subtype.hpp`

**Approach:**
- Add `report_error()` consteval helper using `FixedString<512>`
- Replace each `throw "..."` with `report_error(category, expected, actual, context)`
- Use `reftype::pretty_print()` to render types in messages
- Error format: `type error: <category>\n  expected: ...\n  actual: ...\n  at: ...`

**Error categories:** subtype failure, non-numeric operand, type mismatch, non-boolean operand, condition must be boolean, applying non-function, standalone lambda, incompatible types for join, unsupported tag

## Step 14 — Integration Test + Example

**Goal:** End-to-end validation of the full pipeline.

**New files:**
- `types/tests/test_integration.cpp` — GTest suite
- `types/examples/01_basic_refinement.cpp` — standalone demo
- `types/examples/CMakeLists.txt`

**Modified:** `types/CMakeLists.txt` (add examples subdirectory)

**Test coverage:**
- Well-typed: lit, var, arithmetic, comparisons, conditionals, lambdas, refinement types
- Pipeline: type_check → strip_types → compile → run → verify result
- Failure: `result.valid == false` for ill-typed programs (subtype violations)
